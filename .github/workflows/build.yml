name: Flutter build

on: push

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: â¬†ï¸ Checkout
      uses: actions/checkout@v1
    - name: ğŸ”§ Setup java
      uses: actions/setup-java@v1
      with:
        java-version: '8.x'
    - uses: subosito/flutter-action@v1
      with:
        channel: 'beta' # or: 'stable' or 'dev'
    - name: âœ… Enable platforms
      run: flutter config --enable-web
    - name: ğŸ“¦ Get dependencies
      run: flutter pub get
    #- run: flutter test
    - name: ğŸ­ Build
      run: |
        flutter build apk
    - name: Archive apk
      uses: actions/upload-artifact@v2
      with:
        name: apk-build
        path: build/app/outputs/flutter-apk/app-release.apk
    - name: ğŸš€ Deploy release
      uses: eine/tip@master
      if: github.ref == 'refs/heads/main'
      with:
        tag: release
        token: ${{ secrets.GITHUB_TOKEN }}
        files: build/app/outputs/flutter-apk/app-release.apk
    - name: ğŸš€ Deploy preview
      uses: eine/tip@master
      if: github.ref == 'refs/heads/develop'
      with:
        tag: preview
        token: ${{ secrets.GITHUB_TOKEN }}
        files: build/app/outputs/flutter-apk/app-release.apk